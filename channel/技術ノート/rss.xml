<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[えやみぐさ 技術ノート RSS Feed]]></title><description><![CDATA[技術に関するメモ書き]]></description><link>https://blog.aoirint.com</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 23 Jun 2022 22:48:53 GMT</lastBuildDate><item><title><![CDATA[pip-compileでMetadataGenerationFailedの例外が起きる]]></title><description><![CDATA[pip-compileでMetadataGenerationFailedの例外が起きる pip-compileは、pip-toolsパッケージ（jazzband/pip-tools）に含まれるコマンドで、
Pythonパッケージのリスト requirements.in…]]></description><link>https://blog.aoirint.com/entry/2022/pip_compile_metadata_generation_failed/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/pip_compile_metadata_generation_failed/</guid><pubDate>Fri, 24 Jun 2022 07:10:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;pip-compileでmetadatagenerationfailedの例外が起きる&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#pip-compile%E3%81%A7metadatagenerationfailed%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B&quot; aria-label=&quot;pip compileでmetadatagenerationfailedの例外が起きる permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;pip-compileでMetadataGenerationFailedの例外が起きる&lt;/h1&gt;&lt;p&gt;pip-compileは、pip-toolsパッケージ（jazzband/pip-tools）に含まれるコマンドで、
Pythonパッケージのリスト&lt;code&gt;requirements.in&lt;/code&gt;から、
依存ツリーのライブラリバージョンリスト&lt;code&gt;requirements.txt&lt;/code&gt;を出力してくれる便利なツールである。&lt;/p&gt;&lt;details&gt;&lt;summary&gt;入力例 requirements.in&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;django
requests
gunicorn
mysqlclient
python-dateutil
requests-oauthlib
schedule
&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;pip-compile requirements.in
&lt;/code&gt;&lt;/pre&gt;&lt;details&gt;&lt;summary&gt;出力例 requirements.txt&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;#
# This file is autogenerated by pip-compile with python 3.8
# To update, run:
#
#    pip-compile requirements.in
#
asgiref==3.5.2
    # via django
backports-zoneinfo==0.2.1
    # via django
certifi==2022.6.15
    # via requests
charset-normalizer==2.0.12
    # via requests
django==4.0.5
    # via -r requirements.in
gunicorn==20.1.0
    # via -r requirements.in
idna==3.3
    # via requests
mysqlclient==2.1.1
    # via -r requirements.in
oauthlib==3.2.0
    # via requests-oauthlib
python-dateutil==2.8.2
    # via -r requirements.in
requests==2.28.0
    # via
    #   -r requirements.in
    #   requests-oauthlib
requests-oauthlib==1.3.1
    # via -r requirements.in
schedule==1.1.0
    # via -r requirements.in
six==1.16.0
    # via python-dateutil
sqlparse==0.4.2
    # via django
urllib3==1.26.9
    # via requests

# The following packages are considered to be unsafe in a requirements file:
# setuptools
&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.org/project/pip-tools/&quot;&gt;https://pypi.org/project/pip-tools/&lt;/a&gt; （現在 pip-tools==6.6.2）&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/jazzband/pip-tools&quot;&gt;https://github.com/jazzband/pip-tools&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ところでPythonパッケージは、システムパッケージの事前インストールを要求することがある。
以下、システムパッケージ名はDebian/Ubuntuを想定する。&lt;/p&gt;&lt;p&gt;依存先が動的ライブラリであれば、モジュールのimport時に例外を投げる作りになっている場合もあるが、
Pythonパッケージのインストールと同時にC言語コードからネイティブバイナリをコンパイルするような作りになっている場合には、
コンパイラや依存関係のヘッダファイルなどが必要になることがある。&lt;/p&gt;&lt;p&gt;このような依存関係が不足しているとき、pip-compileは以下のようなエラーログを出力する。&lt;/p&gt;&lt;pre&gt;&lt;code&gt;pip._internal.exceptions.MetadataGenerationFailed: metadata generation failed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ただし、このエラーログが出力されたとき、必ずしも原因が依存関係の不足とは限らない点は指摘しておく。
いまのところpip-compileには、パッケージのインストール処理が記述されたsetup.pyの実行時に例外が起きたとき、その例外の内容が隠されてしまう問題があり、他に原因がある可能性もある。
他に原因がありそうなときには、venvで仮想環境を作るなどして、一度通常のpip installを実行してみて、エラーログを確認して対処するとよいと思う。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/jazzband/pip-tools/issues/1583&quot;&gt;https://github.com/jazzband/pip-tools/issues/1583&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ともあれ、このようなpipに管理されていない依存関係は、
ドキュメントが整備されている通常のPythonパッケージであれば、
PyPIやパッケージの公式ドキュメントに利用者向けの記載があるはずなので、
そちらを確認してインストールしてからpip-compileを実行すると解消するだろう。&lt;/p&gt;&lt;p&gt;例えば、PostgreSQLドライバのpsycopg2は、以下のようなパッケージの事前インストールが必要である。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Cコンパイラ&lt;/li&gt;&lt;li&gt;Pythonのヘッダ&lt;/li&gt;&lt;li&gt;Postgresライブラリlibpqのヘッダ&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt install python3-dev libpq-dev build-essential
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.org/project/psycopg2/&quot;&gt;https://pypi.org/project/psycopg2/&lt;/a&gt; （現在 psycopg2==2.9.3）&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.psycopg.org/docs/install.html#build-prerequisites&quot;&gt;https://www.psycopg.org/docs/install.html#build-prerequisites&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;MySQLドライバのmysqlclientは、以下のようなパッケージの事前インストールが必要である。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt install python3-dev default-libmysqlclient-dev build-essential
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.org/project/mysqlclient/&quot;&gt;https://pypi.org/project/mysqlclient/&lt;/a&gt; （現在 mysqlclient==2.1.1）&lt;/li&gt;&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[自宅サーバのWebサービスをVPSで中継するようにした]]></title><description><![CDATA[自宅サーバのWebサービスをVPSで中継するようにした これまで自宅サーバへの外部からの接続には、
数年前から自宅のグローバルIPアドレスにフリーのドメインを紐づけて使っていたのですが、…]]></description><link>https://blog.aoirint.com/entry/2022/proxy_webservice_on_home_server_with_vps/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/proxy_webservice_on_home_server_with_vps/</guid><pubDate>Thu, 07 Apr 2022 11:00:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;自宅サーバのwebサービスをvpsで中継するようにした&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%85%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AEweb%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92vps%E3%81%A7%E4%B8%AD%E7%B6%99%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F&quot; aria-label=&quot;自宅サーバのwebサービスをvpsで中継するようにした permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自宅サーバのWebサービスをVPSで中継するようにした&lt;/h1&gt;&lt;p&gt;これまで自宅サーバへの外部からの接続には、
数年前から自宅のグローバルIPアドレスにフリーのドメインを紐づけて使っていたのですが、
3月末に更新を忘れてこのドメインを失効させてしまいました。&lt;/p&gt;&lt;p&gt;自宅サーバでは、主に個人用のWebサービスや身内用のゲームサーバが動いています。&lt;/p&gt;&lt;p&gt;同じドメインを再取得するには追加の料金がかかりますし、（若干用途が規約的に怪しいこともあり）新しくドメインを取り直す気にもなれなかったので、
以前から契約していたVPSをTCP/UDPプロキシとして使ってみることにしました。&lt;/p&gt;&lt;p&gt;この記事では、nginx.confのhttpディレクティブとstreamディレクティブそれぞれについて、拡張子でincludeを切り分けるようにする構成にしています。
基本的には、nginx.confに以下のように記述するイメージです。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;http {
        include /etc/nginx/conf.d/*.http;
}

stream {
        include /etc/nginx/conf.d/*.stream;
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;関連ツイート&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://twitter.com/aoirint/status/1510309731642257408&quot;&gt;https://twitter.com/aoirint/status/1510309731642257408&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://twitter.com/aoirint/status/1511896279731040261&quot;&gt;https://twitter.com/aoirint/status/1511896279731040261&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;また、この記事の内容には関係ありませんが、envsubstでconfigファイルに環境変数を注入する、nginxのDocker Hub公式Dockerイメージのtemplate機能を使用しているため、
nginx設定ファイルの拡張子がtemplateになっています。&lt;/p&gt;&lt;p&gt;上のツイートに関連して、&lt;code&gt;certbot --nginx&lt;/code&gt;で自動生成される&lt;code&gt;/etc/letsencrypt/options-ssl-nginx.conf&lt;/code&gt;を手動で&lt;code&gt;nginx.conf&lt;/code&gt;に統合しているので、
以下の設定ではコメントアウトされているincludeがあります。&lt;/p&gt;&lt;h2 id=&quot;構成&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%A7%8B%E6%88%90&quot; aria-label=&quot;構成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;構成&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;自宅サーバ側：systemd + autosshによる自動SSH接続＆リモートポート転送&lt;/li&gt;&lt;li&gt;VPS側：nginxによるHTTPリバースプロキシ・UDPプロキシ&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;自宅サーバ側&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%85%E3%82%B5%E3%83%BC%E3%83%90%E5%81%B4&quot; aria-label=&quot;自宅サーバ側 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自宅サーバ側&lt;/h2&gt;&lt;h3 id=&quot;sshconfig&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#sshconfig&quot; aria-label=&quot;sshconfig permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;~/.ssh/config&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-ssh&quot;&gt;Host vps*
    HostName VPS_IPADDR
    Port VPS_SSH_PORT
    ServerAliveInterval 10
    ServerAliveCountMax 5
    TCPKeepAlive yes
    IdentitiesOnly yes
    IdentityFile ~/.ssh/vps

Host vps-forwarding-homeserver
    # SERVICE1
    RemoteForward 127.0.0.1:VPS_SERVICE1_PORT 127.0.0.1:LOCAL_SERVICE1_PORT

    # SERVICE2
    RemoteForward 127.0.0.1:VPS_SERVICE2_PORT 127.0.0.1:LOCAL_SERVICE2_PORT
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;etcsystemdsystemautossh-vpsservice&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#etcsystemdsystemautossh-vpsservice&quot; aria-label=&quot;etcsystemdsystemautossh vpsservice permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;/etc/systemd/system/autossh-vps.service&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-systemd&quot;&gt;[Unit]
Description=AutoSSH VPS

[Service]
Type=simple
Restart=always
User=user
Group=user
WorkingDirectory=/home/user
ExecStart=/usr/bin/autossh -N vps-forwarding-homeserver

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;vps側&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#vps%E5%81%B4&quot; aria-label=&quot;vps側 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VPS側&lt;/h2&gt;&lt;h3 id=&quot;httpリバースプロキシsshポート転送使用-myservicehttptemplate&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#http%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7ssh%E3%83%9D%E3%83%BC%E3%83%88%E8%BB%A2%E9%80%81%E4%BD%BF%E7%94%A8-myservicehttptemplate&quot; aria-label=&quot;httpリバースプロキシsshポート転送使用 myservicehttptemplate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTTPリバースプロキシ（SSHポート転送使用）: myservice.http.template&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
    server_name myservice.example.com;

    client_max_body_size 500M;

    add_header Strict-Transport-Security &amp;#x27;max-age=15552000; includeSubDomains; preload&amp;#x27;;

    location / {
        #auth_basic &amp;quot;Auth required&amp;quot;;
        #auth_basic_user_file /secrets/myservice.htpasswd;

        proxy_pass http://127.0.0.1:VPS_MYSERVICE_PORT;
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        send_timeout 3600s;
        proxy_connect_timeout 3600s;
        proxy_send_timeout 3600s;
        proxy_read_timeout 3600s;
        #proxy_max_temp_file_size 2048m;
    }

    location /.well-known/acme-challenge/ {
        root /letsencrypt-webroot;
    }

    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/myservice.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/myservice.example.com/privkey.pem;
    # include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

server {
    if ($host = myservice.example.com) {
        return 301 https://$host$request_uri;
    }

    server_name myservice.example.com;
    listen 80;
    return 404;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;udpポート転送sshポート転送不使用-myserviceudpstreamtemplate&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#udp%E3%83%9D%E3%83%BC%E3%83%88%E8%BB%A2%E9%80%81ssh%E3%83%9D%E3%83%BC%E3%83%88%E8%BB%A2%E9%80%81%E4%B8%8D%E4%BD%BF%E7%94%A8-myserviceudpstreamtemplate&quot; aria-label=&quot;udpポート転送sshポート転送不使用 myserviceudpstreamtemplate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;UDPポート転送（SSHポート転送不使用）: myserviceudp.stream.template&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
        listen VPS_SERVICEUDP_PORT udp reuseport;

        proxy_pass HOME_IPADDR:HOME_SERVICEUDP_PORT;
        proxy_connect_timeout 3600s;
        proxy_timeout 3600s;
        #proxy_max_temp_file_size 2048m;
}
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[はてなブログから古い記事を移した]]></title><description><![CDATA[はてなブログから古い記事を移した 新しい記事 blog.aoirint.com へ投稿しつつ、
古い記事は aoirint.hatenablog.com に残っていましたが、
古い記事を blog.aoirint.com…]]></description><link>https://blog.aoirint.com/entry/2022/moved_from_hatenablog/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/moved_from_hatenablog/</guid><pubDate>Tue, 22 Feb 2022 20:40:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;はてなブログから古い記事を移した&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%AD%E3%82%B0%E3%81%8B%E3%82%89%E5%8F%A4%E3%81%84%E8%A8%98%E4%BA%8B%E3%82%92%E7%A7%BB%E3%81%97%E3%81%9F&quot; aria-label=&quot;はてなブログから古い記事を移した permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;はてなブログから古い記事を移した&lt;/h1&gt;&lt;p&gt;新しい記事 blog.aoirint.com へ投稿しつつ、
古い記事は aoirint.hatenablog.com に残っていましたが、
古い記事を blog.aoirint.com に移しました。&lt;/p&gt;&lt;p&gt;古い記事にはリダイレクトと移動先へのリンクを設置しています。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/x-motemen/blogsync&quot;&gt;https://github.com/x-motemen/blogsync&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;blogsyncで記事を取得したあと、以下のようなスクリプトでfrontmatterを変換しました。&lt;/p&gt;&lt;p&gt;以前の移行時の作業ミスでMarkdown記事がHTMLになってしまっていたので、
手動でMarkdownに書き戻しました。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;import glob
import yaml
from datetime import datetime
from pathlib import Path
import frontmatter as FM

for path in glob.glob(&amp;#x27;**/*.md&amp;#x27;, recursive=True):
  if path.startswith(&amp;#x27;output&amp;#x27;):
    continue

  print(path)
  with open(path, &amp;#x27;r&amp;#x27;) as fp:
    frontmatter = FM.load(fp)
    # docs = yaml.safe_load_all(fp)
    # frontmatter = next(docs)
    # body = next(docs)

  body = frontmatter.content
  print(frontmatter)
  print(body)

  title = frontmatter[&amp;#x27;Title&amp;#x27;]
  if title.startswith(&amp;#x27;（移動済）&amp;#x27;):
    print(f&amp;#x27;Skipped: {title}&amp;#x27;)
    continue

  print(f&amp;#x27;Processing: {title}&amp;#x27;)

  original_url = frontmatter[&amp;#x27;URL&amp;#x27;]
  date: datetime = frontmatter[&amp;#x27;Date&amp;#x27;]
  draft = frontmatter.get(&amp;#x27;Draft&amp;#x27;, False)

  tags = frontmatter.get(&amp;#x27;Category&amp;#x27;)
  category = tags[0] if tags else None

  new_frontmatter = {
    &amp;#x27;title&amp;#x27;: title,
    &amp;#x27;date&amp;#x27;: date.strftime(&amp;#x27;%Y-%m-%d %H:%M:%S&amp;#x27;),
    &amp;#x27;draft&amp;#x27;: draft,
    &amp;#x27;channel&amp;#x27;: &amp;#x27;技術ノート&amp;#x27;,
  }
  if category:
    new_frontmatter[&amp;#x27;category&amp;#x27;] = category
  if tags:
    new_frontmatter[&amp;#x27;tags&amp;#x27;] = tags

  output = yaml.dump(new_frontmatter, default_flow_style=False, sort_keys=False, allow_unicode=True)
  output_lines = output.split(&amp;#x27;\n&amp;#x27;)
  output_lines.insert(0, f&amp;#x27;---&amp;#x27;)
  output_lines.insert(1, f&amp;#x27;# moved from {original_url}&amp;#x27;)
  output_lines.insert(-1, f&amp;#x27;---&amp;#x27;)
  output = &amp;#x27;\n&amp;#x27;.join(output_lines)
  output += f&amp;#x27;# {title}\n\n&amp;#x27; + body + &amp;#x27;\n&amp;#x27;

  dest = Path(&amp;#x27;output&amp;#x27;, path)
  dest.parent.mkdir(parents=True, exist_ok=True)

  with open(dest, &amp;#x27;w&amp;#x27;) as fp:
    fp.write(output)
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[VOICEVOX Core 0.5.1をUbuntu + GPU + Pythonで使う（exampleを動かすまで）]]></title><description><![CDATA[VOICEVOX Core 0.5.1をUbuntu + GPU + Pythonで使う（exampleを動かすまで） ※ VOICEVOX Coreにより生成した音声の利用にあたっては、VOICEVOX Coreの添付文書・利用規約を必ず確認し、従ってください。 https…]]></description><link>https://blog.aoirint.com/entry/2021/voicevox_core/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2021/voicevox_core/</guid><pubDate>Sat, 11 Sep 2021 23:40:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;voicevox-core-051をubuntu--gpu--pythonで使うexampleを動かすまで&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#voicevox-core-051%E3%82%92ubuntu--gpu--python%E3%81%A7%E4%BD%BF%E3%81%86example%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99%E3%81%BE%E3%81%A7&quot; aria-label=&quot;voicevox core 051をubuntu  gpu  pythonで使うexampleを動かすまで permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VOICEVOX Core 0.5.1をUbuntu + GPU + Pythonで使う（exampleを動かすまで）&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;※ VOICEVOX Coreにより生成した音声の利用にあたっては、VOICEVOX Coreの添付文書・利用規約を必ず確認し、従ってください。&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/Hiroshiba/voicevox_core&quot;&gt;https://github.com/Hiroshiba/voicevox_core&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;Ubuntu 20.04.3 LTS (Focal Fossa)

Python 3.9.6 (pyenv)

NVIDIA-SMI 470.57.02
Driver Version: 470.57.02
CUDA Version: 11.4

cuDNN 8.2.4
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;voicevoxを使った音声合成について&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#voicevox%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E9%9F%B3%E5%A3%B0%E5%90%88%E6%88%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;voicevoxを使った音声合成について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VOICEVOXを使った音声合成について&lt;/h2&gt;&lt;p&gt;VOICEVOXの音声合成の仕組みについては、以下の記事が参考になるかもしれません。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://blog.hiroshiba.jp/voicevox-engine-introduction/&quot;&gt;VOICEVOXの音声合成エンジンの紹介 | Hiho&amp;#x27;s Blog&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;VOICEVOX Coreを効果的に使うには、ある程度音声合成の専門知識が必要になると思います。&lt;/p&gt;&lt;p&gt;簡易にTTSを利用したい場合には、VOICEVOX EngineのHTTP APIを使うことをおすすめします。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://voicevox.github.io/voicevox_engine/api/&quot;&gt;voicevox_engine API Document&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;VOICEVOX Engineは、公式Dockerイメージが公開されています。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/Hiroshiba/voicevox_engine&quot;&gt;https://github.com/Hiroshiba/voicevox_engine&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://hub.docker.com/r/hiroshiba/voicevox_engine&quot;&gt;https://hub.docker.com/r/hiroshiba/voicevox_engine&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;voicevox-coreのインタフェースについて&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#voicevox-core%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;voicevox coreのインタフェースについて permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VOICEVOX Coreのインタフェースについて&lt;/h3&gt;&lt;details&gt;&lt;p&gt;わたしは音声合成については素人ですが、参考のため現在の理解を書いておきます。&lt;/p&gt;&lt;p&gt;VOICEVOX Coreでは、
「音素ごとの長さの推定 &lt;code&gt;replace_phoneme_length / yukarin_s_forward&lt;/code&gt;」、
「モーラごとの音高の推定 &lt;code&gt;replace_mora_pitch / yukarin_sa_forward&lt;/code&gt;」、
「音声波形の推定 &lt;code&gt;synthesis / decode_forward&lt;/code&gt;」の3つの深層学習モデルを使って音声合成します。&lt;/p&gt;&lt;p&gt;OpenJTalkには、辞書に基づいてテキストを解析し、アクセント句・モーラ・アクセント位置・疑問文フラグなどの情報で構成された
フルコンテキストラベルというデータに変換する機能があります。&lt;/p&gt;&lt;p&gt;フルコンテキストラベルの仕様は、以下のURLを開き、
&lt;code&gt;HTS-2.3 &amp;gt; Speaker dependent training demo &amp;gt; Japanese &amp;gt; tar.bz2&lt;/code&gt;から&lt;code&gt;HTS-demo_NIT-ATR503-M001.tar.bz2&lt;/code&gt;をダウンロード・展開し、
&lt;code&gt;data/lab_format.pdf&lt;/code&gt;を見ると英語で記述されています。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://hts.sp.nitech.ac.jp/?Download#u879c944&quot;&gt;https://hts.sp.nitech.ac.jp/?Download#u879c944&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://twitter.com/hiho_karuta/status/1059845813143138304&quot;&gt;https://twitter.com/hiho_karuta/status/1059845813143138304&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;VOICEVOX Engineでは、フルコンテキストラベルやVOICEVOX Coreを使って、
テキストを調声用のデータ構造（AudioQuery）に変換し、
また調声用のデータ構造を音声（Wav）に変換します。&lt;/p&gt;&lt;p&gt;VOICEVOXエディタでは、調声用のデータ構造を操作して、アクセント位置、音高（日本語ではイントネーションと同じらしい）、音素長を調声するUIなどが実装されています。&lt;/p&gt;&lt;/details&gt;&lt;h2 id=&quot;libtorch版とonnx版について&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#libtorch%E7%89%88%E3%81%A8onnx%E7%89%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;libtorch版とonnx版について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LibTorch版とONNX版について&lt;/h2&gt;&lt;p&gt;VOICEVOXは、0.10から深層学習モデル推論時のバックエンドをLibTorchからONNX Runtimeに移行しました。&lt;/p&gt;&lt;p&gt;この記事では、VOICEVOX 0.9までのLibTorch版コアを前提にしています（最初に記事を書いたときは0.5.1でした）。&lt;/p&gt;&lt;p&gt;PythonでONNX版のVOICEVOX Coreを使う手順はリポジトリにドキュメントがあるので参照してください（時間があればそのうち記事を書くかもです）。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/VOICEVOX/voicevox_core/tree/f27fd1ca22aa299755d0f646874919a034bc5085#voicevox-core&quot;&gt;https://github.com/VOICEVOX/voicevox_core/tree/f27fd1ca22aa299755d0f646874919a034bc5085#voicevox-core&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;libtorchのダウンロード&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#libtorch%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89&quot; aria-label=&quot;libtorchのダウンロード permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LibTorchのダウンロード&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pytorch.org/&quot;&gt;https://pytorch.org/&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Stable &amp;gt; Linux &amp;gt; LibTorch &amp;gt; C++/Java &amp;gt; CUDA 11.1 &amp;gt; Download here (cxx11 ABI)&lt;/p&gt;&lt;p&gt;&lt;code&gt;libtorch-cxx11-abi-shared-with-deps-1.9.0+cu111.zip&lt;/code&gt;を使用した。
圧縮時で2.1GB、展開時で5.1GB。&lt;/p&gt;&lt;p&gt;&lt;code&gt;~/local/libtorch&lt;/code&gt;以下に、&lt;code&gt;~/local/libtorch/build-version&lt;/code&gt;のように全ファイルを展開する。&lt;/p&gt;&lt;h2 id=&quot;voicevox-coreのダウンロード&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#voicevox-core%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89&quot; aria-label=&quot;voicevox coreのダウンロード permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VOICEVOX Coreのダウンロード&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/Hiroshiba/voicevox_core/releases/tag/0.5.1&quot;&gt;https://github.com/Hiroshiba/voicevox_core/releases/tag/0.5.1&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;圧縮時・展開時ともに430MB。&lt;/p&gt;&lt;p&gt;&lt;code&gt;~/local/voicevox_core&lt;/code&gt;以下に、&lt;code&gt;~/local/voicevox_core/libcore.so&lt;/code&gt;のように全ファイルを展開する。&lt;/p&gt;&lt;h2 id=&quot;bashrc&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#bashrc&quot; aria-label=&quot;bashrc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;.bashrc&lt;/h2&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;export LIBRARY_PATH=&amp;quot;$HOME/local/voicevox_core:$LIBRARY_PATH&amp;quot;
export LIBRARY_PATH=&amp;quot;$HOME/local/libtorch/lib:$LIBRARY_PATH&amp;quot;
export LD_LIBRARY_PATH=&amp;quot;$HOME/local/voicevox_core:$LD_LIBRARY_PATH&amp;quot;
export LD_LIBRARY_PATH=&amp;quot;$HOME/local/libtorch/lib:$LD_LIBRARY_PATH&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;source ~/.bashrc
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;サンプルリポジトリをクローン&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%B3&quot; aria-label=&quot;サンプルリポジトリをクローン permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;サンプルリポジトリをクローン&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/Hiroshiba/voicevox_core&quot;&gt;https://github.com/Hiroshiba/voicevox_core&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;git clone https://github.com/Hiroshiba/voicevox_core.git
cd voicevox_core

# 再現性のためにバージョンを固定、実際は最新版の使用を推奨
git checkout 89d0962ab54269023fe0ec3170c7075744f38702
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;corehをコピー&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#coreh%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC&quot; aria-label=&quot;corehをコピー permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;core.hをコピー&lt;/h2&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;cp core.h example/python/

cd example/python
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;パッケージのインストール&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&quot; aria-label=&quot;パッケージのインストール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;パッケージのインストール&lt;/h2&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;# 依存パッケージのインストール
pip3 install -r requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;pipを使ったインストール&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#pip%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&quot; aria-label=&quot;pipを使ったインストール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;pipを使ったインストール&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;# coreモジュール（VOICEVOX Core Pythonライブラリ）のインストール
pip3 install .
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;distutilsを使ったインストール&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#distutils%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&quot; aria-label=&quot;distutilsを使ったインストール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;distutilsを使ったインストール&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;# coreモジュール（VOICEVOX Core Pythonライブラリ）のインストール
python3 setup.py install --record files.txt


# 失敗時
python3 setup.py clean
rm -rf build/ core.cpp
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;files.txt&lt;/code&gt;にインストールされたファイル一覧が出力される。
アンインストール時は、&lt;code&gt;files.txt&lt;/code&gt;に列挙されたファイルを手動で削除する。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://qiita.com/orion0616/items/dfe476067e499cca8535&quot;&gt;https://qiita.com/orion0616/items/dfe476067e499cca8535&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;filestxt&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#filestxt&quot; aria-label=&quot;filestxt permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;files.txt&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;***/lib/python3.9/site-packages/core.cpython-39-x86_64-linux-gnu.so
***/lib/python3.9/site-packages/core-0.0.0-py3.9.egg-info
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;サンプルプログラムrunpyの改変&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0runpy%E3%81%AE%E6%94%B9%E5%A4%89&quot; aria-label=&quot;サンプルプログラムrunpyの改変 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;サンプルプログラム（run.py）の改変&lt;/h2&gt;&lt;p&gt;&lt;code&gt;core.initialize&lt;/code&gt;の第1引数を&lt;code&gt;libcore.so&lt;/code&gt;のあるディレクトリのパスに変更する。（末尾のスラッシュは必須）。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;    core.initialize(&amp;quot;/home/user/local/voicevox_core/&amp;quot;, use_gpu)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;改変したサンプルプログラムrunpyの実行&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%94%B9%E5%A4%89%E3%81%97%E3%81%9F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0runpy%E3%81%AE%E5%AE%9F%E8%A1%8C&quot; aria-label=&quot;改変したサンプルプログラムrunpyの実行 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;改変したサンプルプログラム（run.py）の実行&lt;/h2&gt;&lt;h3 id=&quot;四国めたん&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E5%9B%9B%E5%9B%BD%E3%82%81%E3%81%9F%E3%82%93&quot; aria-label=&quot;四国めたん permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;四国めたん&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;python3 run.py --use_gpu --text &amp;quot;こんにちは&amp;quot; --speaker_id 0

paplay &amp;quot;./こんにちは-0.wav&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;ずんだもん&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%9A%E3%82%93%E3%81%A0%E3%82%82%E3%82%93&quot; aria-label=&quot;ずんだもん permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ずんだもん&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;python3 run.py --use_gpu --text &amp;quot;こんにちはなのだ&amp;quot; --speaker_id 1

paplay &amp;quot;./こんにちはなのだ-0.wav&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;使用するgpuの変更複数台のgpuが接続された環境&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8Bgpu%E3%81%AE%E5%A4%89%E6%9B%B4%E8%A4%87%E6%95%B0%E5%8F%B0%E3%81%AEgpu%E3%81%8C%E6%8E%A5%E7%B6%9A%E3%81%95%E3%82%8C%E3%81%9F%E7%92%B0%E5%A2%83&quot; aria-label=&quot;使用するgpuの変更複数台のgpuが接続された環境 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用するGPUの変更（複数台のGPUが接続された環境）&lt;/h2&gt;&lt;p&gt;CUDAを使うアプリケーション一般に適用できる方法。数値は&lt;code&gt;nvidia-smi&lt;/code&gt;で確認できるGPU番号とは異なることがあるので注意。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;CUDA_VISIBLE_DEVICES=0 python3 run.py --use_gpu --text &amp;quot;こんにちは&amp;quot; --speaker_id 0
CUDA_VISIBLE_DEVICES=1 python3 run.py --use_gpu --text &amp;quot;こんにちは&amp;quot; --speaker_id 0
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;その他参考&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%9D%E3%81%AE%E4%BB%96%E5%8F%82%E8%80%83&quot; aria-label=&quot;その他参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;その他参考&lt;/h2&gt;&lt;p&gt;&lt;code&gt;LD_LIBRARY_PATH&lt;/code&gt;について調べていたが、コンパイル（&lt;code&gt;python3 setup.py install&lt;/code&gt;）時に必要（&lt;code&gt;g++&lt;/code&gt;が見に行くパス）なのは&lt;code&gt;LIBRARY_PATH&lt;/code&gt;、実行時（&lt;code&gt;core&lt;/code&gt;モジュールロード時）に必要なのは&lt;code&gt;LD_LIBRARY_PATH&lt;/code&gt;ということらしかった。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://bettamodoki.hatenadiary.jp/entry/20121121/1353480891&quot;&gt;https://bettamodoki.hatenadiary.jp/entry/20121121/1353480891&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr/&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://atmarkit.itmedia.co.jp/flinux/rensai/linuxtips/a115makeerror.html&quot;&gt;https://atmarkit.itmedia.co.jp/flinux/rensai/linuxtips/a115makeerror.html&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://please-sleep.cou929.nu/20080718.html&quot;&gt;https://please-sleep.cou929.nu/20080718.html&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://qiita.com/Esfahan/items/0064d845ca6faf7f3d47&quot;&gt;https://qiita.com/Esfahan/items/0064d845ca6faf7f3d47&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://qiita.com/kazatsuyu/items/5c8d9f539cd925fda007&quot;&gt;https://qiita.com/kazatsuyu/items/5c8d9f539cd925fda007&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content:encoded><atom:updated>Thu, 03 Feb 2022 10:30:00 GMT</atom:updated></item><item><title><![CDATA[MediaWikiのセットアップ]]></title><description><![CDATA[MediaWikiのセットアップ インストール Docker Hub公式のDockerイメージが公開されている。 Mediawiki - Official Image | Docker Hub 事前準備 docker-compose.yml nginx設定ファイル (/etc…]]></description><link>https://blog.aoirint.com/entry/2022/mediawiki_docker/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/mediawiki_docker/</guid><pubDate>Thu, 03 Feb 2022 07:00:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;mediawikiのセットアップ&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#mediawiki%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97&quot; aria-label=&quot;mediawikiのセットアップ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MediaWikiのセットアップ&lt;/h1&gt;&lt;h2 id=&quot;インストール&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&quot; aria-label=&quot;インストール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;インストール&lt;/h2&gt;&lt;p&gt;Docker Hub公式のDockerイメージが公開されている。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://hub.docker.com/_/mediawiki/&quot;&gt;Mediawiki - Official Image | Docker Hub&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;事前準備&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99&quot; aria-label=&quot;事前準備 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;事前準備&lt;/h3&gt;&lt;h4 id=&quot;docker-composeyml&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#docker-composeyml&quot; aria-label=&quot;docker composeyml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;docker-compose.yml&lt;/h4&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot;&gt;version: &amp;#x27;3.8&amp;#x27;
services:
  mediawiki:
    image: mediawiki:1.37
    restart: always
    ports:
      - &amp;#x27;127.0.0.1:8000:80&amp;#x27;
    links:
      - database
    volumes:
      - ./app/images:/var/www/html/images
      # After initial setup, download LocalSettings.php to the same directory as
      # this yaml and uncomment the following line and use compose to restart
      # the mediawiki service
      # - ./LocalSettings.php:/var/www/html/LocalSettings.php
      # - ./app/extensions:/var/www/html/extensions
  # This key also defines the name of the database host used during setup instead of the default &amp;quot;localhost&amp;quot;
  database:
    image: mariadb:10.7
    restart: always
    volumes:
      - database-data:/var/lib/mysql
    environment:
      # @see https://phabricator.wikimedia.org/source/mediawiki/browse/master/includes/DefaultSettings.php
      MYSQL_DATABASE: my_wiki
      MYSQL_USER: wikiuser
      MYSQL_PASSWORD: example
      MYSQL_RANDOM_ROOT_PASSWORD: &amp;#x27;yes&amp;#x27;
volumes:
  database-data:
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&quot;nginx設定ファイル-etcnginxsites-enabledwikiexamplecomconf&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#nginx%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-etcnginxsites-enabledwikiexamplecomconf&quot; aria-label=&quot;nginx設定ファイル etcnginxsites enabledwikiexamplecomconf permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;nginx設定ファイル (/etc/nginx/sites-enabled/wiki.example.com.conf）&lt;/h4&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
    server_name wiki.example.com;

    proxy_set_header HOST $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Server $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    # auth_basic &amp;quot;Authentication Required&amp;quot;;
    # auth_basic_user_file /path/to/.htpasswd;

    location / {
        proxy_pass http://localhost:8000;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;手順&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%89%8B%E9%A0%86&quot; aria-label=&quot;手順 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;手順&lt;/h3&gt;&lt;ol&gt;&lt;li&gt;docker-compose.yml、nginx設定ファイルを作成&lt;ul&gt;&lt;li&gt;必要に応じて&lt;code&gt;sudo certbot --nginx&lt;/code&gt;でHTTPS対応&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;添付ファイルのアップロード先ディレクトリを作成 &lt;code&gt;mkdir -p app/images&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;docker-compose up -d&lt;/code&gt;でMediaWikiを起動&lt;ul&gt;&lt;li&gt;起動時に&lt;code&gt;wikiexamplecom_mediawiki_1 is up-to-date&lt;/code&gt;のようなログが表示されるので、&lt;code&gt;is&lt;/code&gt;より前のMediaWikiコンテナ名を控える&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;ブラウザから初期設定&lt;/li&gt;&lt;li&gt;設定ファイル&lt;code&gt;LocalSettings.php&lt;/code&gt;をコピー&lt;ul&gt;&lt;li&gt;&lt;code&gt;sudo docker cp MediaWikiコンテナ名:/var/www/html/LocalSettings.php ./LocalSettings.php&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;拡張機能をコピー&lt;ul&gt;&lt;li&gt;&lt;code&gt;sudo docker cp MediaWikiコンテナ名:/var/www/html/extensions ./app/extensions&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;docker-compose.ymlを開き、&lt;code&gt;./LocalSettings.php&lt;/code&gt;、&lt;code&gt;./app/extensions&lt;/code&gt;のコメントアウトを解除&lt;/li&gt;&lt;li&gt;コンテナを再作成&lt;ul&gt;&lt;li&gt;&lt;code&gt;sudo docker-compose up -d --force-recreate&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&quot;拡張機能のインストール&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&quot; aria-label=&quot;拡張機能のインストール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;拡張機能のインストール&lt;/h2&gt;&lt;h3 id=&quot;手順-1&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%89%8B%E9%A0%86-1&quot; aria-label=&quot;手順 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;手順&lt;/h3&gt;&lt;ol&gt;&lt;li&gt;拡張機能の配布ファイル（tar.gz）をサーバにダウンロード&lt;/li&gt;&lt;li&gt;配布ファイルを展開&lt;/li&gt;&lt;li&gt;展開した拡張機能ディレクトリを&lt;code&gt;app/extensions&lt;/code&gt;以下にコピー（&lt;code&gt;app/extensions/Math&lt;/code&gt;のように）&lt;ul&gt;&lt;li&gt;Dockerコンテナ内では&lt;code&gt;/var/www/html/extensions/Math&lt;/code&gt;のように配置される&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;LocalSettings.php&lt;/code&gt;に&lt;code&gt;wfLoadExtension( &amp;#x27;拡張機能ディレクトリ名&amp;#x27; );&lt;/code&gt;のように追記&lt;ul&gt;&lt;li&gt;&lt;code&gt;wfLoadExtension( &amp;#x27;Math&amp;#x27; );&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;wfLoadExtension( &amp;#x27;SyntaxHighlight_GeSHi&amp;#x27; );&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;「メンテナンス：再起動」を実行&lt;/li&gt;&lt;li&gt;「メンテナンス：データベース構造の更新」を実行&lt;/li&gt;&lt;/ol&gt;&lt;h3 id=&quot;数式math&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E5%BC%8Fmath&quot; aria-label=&quot;数式math permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数式（Math）&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://www.mediawiki.org/wiki/Extension:Math&quot;&gt;Extension:Math - MediaWiki&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.mediawiki.org/wiki/Special:ExtensionDistributor/Math&quot;&gt;Download MediaWiki extension - MediaWiki&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;シンタックスハイライトsyntaxhighlight&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%82%B7%E3%83%B3%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B9%E3%83%8F%E3%82%A4%E3%83%A9%E3%82%A4%E3%83%88syntaxhighlight&quot; aria-label=&quot;シンタックスハイライトsyntaxhighlight permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;シンタックスハイライト（SyntaxHighlight）&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://www.mediawiki.org/wiki/Extension:SyntaxHighlight&quot;&gt;Extension:SyntaxHighlight - MediaWiki&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.mediawiki.org/wiki/Special:ExtensionDistributor/SyntaxHighlight_GeSHi&quot;&gt;Download MediaWiki extension - MediaWiki&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;設定&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E8%A8%AD%E5%AE%9A&quot; aria-label=&quot;設定 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;設定&lt;/h2&gt;&lt;h3 id=&quot;ロゴを変更&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%83%AD%E3%82%B4%E3%82%92%E5%A4%89%E6%9B%B4&quot; aria-label=&quot;ロゴを変更 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ロゴを変更&lt;/h3&gt;&lt;h4 id=&quot;localsettingsphp&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#localsettingsphp&quot; aria-label=&quot;localsettingsphp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LocalSettings.php&lt;/h4&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot;&gt;## The URL paths to the logo.  Make sure you change this from the default,
## or else you&amp;#x27;ll overwrite your logo when you upgrade!
#$wgLogos = [ &amp;#x27;1x&amp;#x27; =&amp;gt; &amp;quot;$wgResourceBasePath/resources/assets/wiki.png&amp;quot; ];
$wgLogos = [ &amp;#x27;1x&amp;#x27; =&amp;gt; &amp;quot;$wgResourceBasePath/images/logo.png&amp;quot; ];
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&quot;手順-2&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%89%8B%E9%A0%86-2&quot; aria-label=&quot;手順 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;手順&lt;/h4&gt;&lt;ol&gt;&lt;li&gt;LocalSettings.phpを編集&lt;/li&gt;&lt;li&gt;ロゴ画像を&lt;code&gt;app/images/logo.png&lt;/code&gt;に配置&lt;/li&gt;&lt;li&gt;「メンテナンス：再起動」を実行&lt;/li&gt;&lt;/ol&gt;&lt;h3 id=&quot;既定のタイムゾーンを変更&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%97%A2%E5%AE%9A%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%BE%E3%83%BC%E3%83%B3%E3%82%92%E5%A4%89%E6%9B%B4&quot; aria-label=&quot;既定のタイムゾーンを変更 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;既定のタイムゾーンを変更&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://www.mediawiki.org/wiki/Manual:Timezone&quot;&gt;Manual:Timezone - MediaWiki&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;localsettingsphp-1&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#localsettingsphp-1&quot; aria-label=&quot;localsettingsphp 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LocalSettings.php&lt;/h4&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot;&gt;# Time zone
#$wgLocaltimezone = &amp;quot;UTC&amp;quot;;
$wgLocaltimezone = &amp;quot;Asia/Tokyo&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&quot;手順-3&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%89%8B%E9%A0%86-3&quot; aria-label=&quot;手順 3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;手順&lt;/h4&gt;&lt;ol&gt;&lt;li&gt;LocalSettings.phpを編集&lt;/li&gt;&lt;li&gt;「メンテナンス：再起動」を実行&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&quot;メンテナンス&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9&quot; aria-label=&quot;メンテナンス permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;メンテナンス&lt;/h2&gt;&lt;h3 id=&quot;再起動&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E5%86%8D%E8%B5%B7%E5%8B%95&quot; aria-label=&quot;再起動 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;再起動&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo docker-compose up -d --force-recreate
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;データベース構造の更新&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E6%A7%8B%E9%80%A0%E3%81%AE%E6%9B%B4%E6%96%B0&quot; aria-label=&quot;データベース構造の更新 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;データベース構造の更新&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://www.mediawiki.org/wiki/Manual:Update.php&quot;&gt;Manual:update.php - MediaWiki&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo docker-compose exec -u 1000 mediawiki php maintenance/update.php
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[OBS Studio on Ubuntu 20.04 + NVIDIA GPUでWindow Captureを動作させる]]></title><description><![CDATA[OBS Studio on Ubuntu 20.04 + NVIDIA GPUでWindow Captureを動作させる Bug Report - [SOLVED] Window Capture Black Screen | OBS Forums Ubuntu + NVIDIA…]]></description><link>https://blog.aoirint.com/entry/2020/obs_ubuntu_nvidia_window_capture/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2020/obs_ubuntu_nvidia_window_capture/</guid><pubDate>Mon, 09 Nov 2020 06:10:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;obs-studio-on-ubuntu-2004--nvidia-gpuでwindow-captureを動作させる&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#obs-studio-on-ubuntu-2004--nvidia-gpu%E3%81%A7window-capture%E3%82%92%E5%8B%95%E4%BD%9C%E3%81%95%E3%81%9B%E3%82%8B&quot; aria-label=&quot;obs studio on ubuntu 2004  nvidia gpuでwindow captureを動作させる permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OBS Studio on Ubuntu 20.04 + NVIDIA GPUでWindow Captureを動作させる&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://obsproject.com/forum/threads/solved-window-capture-black-screen.47082/&quot;&gt;Bug Report - [SOLVED] Window Capture Black Screen | OBS Forums&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Ubuntu + NVIDIA GPU環境では、OBS StudioでWindow Captureしようとすると
一部のアプリケーションで黒画面の表示になり動作しない。
おそらくOpenGLで描画しているものが対象。&lt;/p&gt;&lt;p&gt;いくつか対処法の候補がある。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Alt+F2から&lt;code&gt;r&lt;/code&gt;を入力して実行&lt;/li&gt;&lt;li&gt;アプリケーションをフルスクリーン表示からウインドウ表示に切り替える&lt;/li&gt;&lt;li&gt;アプリケーションをウインドウ表示からフルスクリーン表示に切り替える&lt;/li&gt;&lt;li&gt;&lt;code&gt;Window Capture (Xcomposite)&lt;/code&gt;の設定欄をスクロールして、&lt;code&gt;Use alpha-less texture format (Mesa workaround)&lt;/code&gt;にチェックを入れる&lt;/li&gt;&lt;li&gt;OSを再起動（GPUドライバに更新が入ったときなど）&lt;/li&gt;&lt;/ul&gt;</content:encoded><atom:updated>Sun, 23 Jan 2022 11:50:00 GMT</atom:updated></item></channel></rss>