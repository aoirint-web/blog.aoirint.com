<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[えやみぐさ RSS Feed]]></title><description><![CDATA[えやみぐさ RSS Feed]]></description><link>https://blog.aoirint.com</link><generator>GatsbyJS</generator><lastBuildDate>Fri, 24 Jun 2022 00:33:36 GMT</lastBuildDate><item><title><![CDATA[GitHub ActionsでPyPIにPythonパッケージをpushする（GitHub Release連携でバージョン付け）]]></title><description><![CDATA[GitHub ActionsでPyPIにPythonパッケージをpushする（GitHub Release連携でバージョン付け） https://qiita.com/aoirint/items/09ea153751a65bf4876f#github-release%E4%BD…]]></description><link>https://blog.aoirint.com/entry/2022/github_actions_push_to_pypi/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/github_actions_push_to_pypi/</guid><pubDate>Fri, 24 Jun 2022 09:20:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;github-actionsでpypiにpythonパッケージをpushするgithub-release連携でバージョン付け&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#github-actions%E3%81%A7pypi%E3%81%ABpython%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92push%E3%81%99%E3%82%8Bgithub-release%E9%80%A3%E6%90%BA%E3%81%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BB%98%E3%81%91&quot; aria-label=&quot;github actionsでpypiにpythonパッケージをpushするgithub release連携でバージョン付け permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub ActionsでPyPIにPythonパッケージをpushする（GitHub Release連携でバージョン付け）&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://qiita.com/aoirint/items/09ea153751a65bf4876f#github-release%E4%BD%9C%E6%88%90%E6%99%82%E3%81%ABpypi%E3%81%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89&quot;&gt;https://qiita.com/aoirint/items/09ea153751a65bf4876f#github-release%E4%BD%9C%E6%88%90%E6%99%82%E3%81%ABpypi%E3%81%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;上の記事のWorkflowテンプレートをちょっと改良した。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;GitHub Release作成時にリリースタグをパッケージバージョンにしてpush&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;構成&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%A7%8B%E6%88%90&quot; aria-label=&quot;構成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;構成&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mypackage/__init__.py&lt;/code&gt;に以下のように開発用のバージョン情報を記述する。
リリース時にGithub Actionsでリリースタグに置換してからPyPIにpushする。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;__VERSION__ = &amp;#x27;0.0.0&amp;#x27;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;github-secrets&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#github-secrets&quot; aria-label=&quot;github secrets permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub Secrets&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;PYPI_API_TOKEN&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;github-workflow-githubworkflowspypiyml&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#github-workflow-githubworkflowspypiyml&quot; aria-label=&quot;github workflow githubworkflowspypiyml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub Workflow .github/workflows/pypi.yml&lt;/h2&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot;&gt;name: Publish a package to PyPI

on:
  release:
    types:
      - created

env:
  VERSION: ${{ github.event.release.tag_name != &amp;#x27;&amp;#x27; &amp;amp;&amp;amp; github.event.release.tag_name || &amp;#x27;0.0.0&amp;#x27; }}

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x

      - name: Install Dependencies
        run: |
            pip3 install -r requirements.txt
            pip3 install wheel
      - name: Replace version
        run: |
          sed -i &amp;quot;s/__VERSION__ = &amp;#x27;0.0.0&amp;#x27;/__VERSION__ = &amp;#x27;${{ env.VERSION }}&amp;#x27;/&amp;quot; mypackage/__init__.py
      - name: Build Package
        run: python3 setup.py sdist bdist_wheel

      - name: Publish to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          user: __token__
          password: ${{ secrets.PYPI_API_TOKEN }}
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[GitHub ActionsでDocker RegistryにDockerイメージをpushする（latestタグ、GitHub Release連携バージョン付きタグ）]]></title><description><![CDATA[GitHub ActionsでDocker RegistryにDockerイメージをpushする（latestタグ、GitHub Release連携バージョン付きタグ） https://blog.aoirint.com/entry/2021/github_actions…]]></description><link>https://blog.aoirint.com/entry/2022/github_actions_push_to_docker_registry_versioned/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/github_actions_push_to_docker_registry_versioned/</guid><pubDate>Fri, 24 Jun 2022 09:10:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;github-actionsでdocker-registryにdockerイメージをpushするlatestタグgithub-release連携バージョン付きタグ&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#github-actions%E3%81%A7docker-registry%E3%81%ABdocker%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92push%E3%81%99%E3%82%8Blatest%E3%82%BF%E3%82%B0github-release%E9%80%A3%E6%90%BA%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BB%98%E3%81%8D%E3%82%BF%E3%82%B0&quot; aria-label=&quot;github actionsでdocker registryにdockerイメージをpushするlatestタグgithub release連携バージョン付きタグ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub ActionsでDocker RegistryにDockerイメージをpushする（latestタグ、GitHub Release連携バージョン付きタグ）&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://blog.aoirint.com/entry/2021/github_actions_docker_io_token/&quot;&gt;https://blog.aoirint.com/entry/2021/github_actions_docker_io_token/&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;上の記事のWorkflowテンプレートをちょっと改良した。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Docker Hub以外のDockerレジストリに対応&lt;/li&gt;&lt;li&gt;GitHub Release作成時にリリースタグをイメージタグにしてpush&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;レジストリurl&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AAurl&quot; aria-label=&quot;レジストリurl permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;レジストリURL&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;Docker Hub: &lt;code&gt;docker.io&lt;/code&gt;&lt;/li&gt;&lt;li&gt;GitHub Container Registry: &lt;code&gt;ghcr.io&lt;/code&gt;&lt;/li&gt;&lt;li&gt;GitLab Container Registry: &lt;code&gt;registry.gitlab.com&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;github-secrets&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#github-secrets&quot; aria-label=&quot;github secrets permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub Secrets&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;DOCKER_USERNAME&lt;/li&gt;&lt;li&gt;DOCKER_TOKEN&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;github-workflow-githubworkflowsdockeryml&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#github-workflow-githubworkflowsdockeryml&quot; aria-label=&quot;github workflow githubworkflowsdockeryml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub Workflow .github/workflows/docker.yml&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/docker/login-action&quot;&gt;https://github.com/docker/login-action&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/docker/build-push-action&quot;&gt;https://github.com/docker/build-push-action&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot;&gt;name: Push to Docker registry

on:
  push:
    branches:
      - main
  release:
    types:
      - created

env:
  IMAGE_NAME: docker.io/username/imagename
  IMAGE_TAG: ${{ github.event.release.tag_name != &amp;#x27;&amp;#x27; &amp;amp;&amp;amp; github.event.release.tag_name || &amp;#x27;latest&amp;#x27; }}

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Docker Buildx
        id: buildx
        uses: docker/setup-buildx-action@v2

      - name: Login to Docker Registry
        uses: docker/login-action@v2
        with:
          registry: docker.io
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_TOKEN }}

      - name: Build and Deploy Docker image
        uses: docker/build-push-action@v3
        env:
          IMAGE_NAME_AND_TAG: ${{ format(&amp;#x27;{0}:{1}&amp;#x27;, env.IMAGE_NAME, env.IMAGE_TAG) }}
        with:
          context: .
          builder: ${{ steps.buildx.outputs.name }}
          file: ./Dockerfile
          push: true
          tags: ${{ env.IMAGE_NAME_AND_TAG }}
          cache-from: type=registry,ref=${{ env.IMAGE_NAME_AND_TAG }}-buildcache
          cache-to: type=registry,ref=${{ env.IMAGE_NAME_AND_TAG }}-buildcache,mode=max
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[pip-compileでMetadataGenerationFailedの例外が起きる]]></title><description><![CDATA[pip-compileでMetadataGenerationFailedの例外が起きる pip-compileは、pip-toolsパッケージ（jazzband/pip-tools）に含まれるコマンドで、
Pythonパッケージのリスト requirements.in…]]></description><link>https://blog.aoirint.com/entry/2022/pip_compile_metadata_generation_failed/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/pip_compile_metadata_generation_failed/</guid><pubDate>Fri, 24 Jun 2022 07:10:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;pip-compileでmetadatagenerationfailedの例外が起きる&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#pip-compile%E3%81%A7metadatagenerationfailed%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B&quot; aria-label=&quot;pip compileでmetadatagenerationfailedの例外が起きる permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;pip-compileでMetadataGenerationFailedの例外が起きる&lt;/h1&gt;&lt;p&gt;pip-compileは、pip-toolsパッケージ（jazzband/pip-tools）に含まれるコマンドで、
Pythonパッケージのリスト&lt;code&gt;requirements.in&lt;/code&gt;から、
依存ツリーのライブラリバージョンリスト&lt;code&gt;requirements.txt&lt;/code&gt;を出力してくれる便利なツールである。&lt;/p&gt;&lt;details&gt;&lt;summary&gt;入力例 requirements.in&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;django
requests
gunicorn
mysqlclient
python-dateutil
requests-oauthlib
schedule
&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;pip-compile requirements.in
&lt;/code&gt;&lt;/pre&gt;&lt;details&gt;&lt;summary&gt;出力例 requirements.txt&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;#
# This file is autogenerated by pip-compile with python 3.8
# To update, run:
#
#    pip-compile requirements.in
#
asgiref==3.5.2
    # via django
backports-zoneinfo==0.2.1
    # via django
certifi==2022.6.15
    # via requests
charset-normalizer==2.0.12
    # via requests
django==4.0.5
    # via -r requirements.in
gunicorn==20.1.0
    # via -r requirements.in
idna==3.3
    # via requests
mysqlclient==2.1.1
    # via -r requirements.in
oauthlib==3.2.0
    # via requests-oauthlib
python-dateutil==2.8.2
    # via -r requirements.in
requests==2.28.0
    # via
    #   -r requirements.in
    #   requests-oauthlib
requests-oauthlib==1.3.1
    # via -r requirements.in
schedule==1.1.0
    # via -r requirements.in
six==1.16.0
    # via python-dateutil
sqlparse==0.4.2
    # via django
urllib3==1.26.9
    # via requests

# The following packages are considered to be unsafe in a requirements file:
# setuptools
&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.org/project/pip-tools/&quot;&gt;https://pypi.org/project/pip-tools/&lt;/a&gt; （現在 pip-tools==6.6.2）&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/jazzband/pip-tools&quot;&gt;https://github.com/jazzband/pip-tools&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ところでPythonパッケージは、システムパッケージの事前インストールを要求することがある。
以下、システムパッケージ名はDebian/Ubuntuを想定する。&lt;/p&gt;&lt;p&gt;依存先が動的ライブラリであれば、モジュールのimport時に例外を投げる作りになっている場合もあるが、
Pythonパッケージのインストールと同時にC言語コードからネイティブバイナリをコンパイルするような作りになっている場合には、
コンパイラや依存関係のヘッダファイルなどが必要になることがある。&lt;/p&gt;&lt;p&gt;このような依存関係が不足しているとき、pip-compileは以下のようなエラーログを出力する。&lt;/p&gt;&lt;pre&gt;&lt;code&gt;pip._internal.exceptions.MetadataGenerationFailed: metadata generation failed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ただし、このエラーログが出力されたとき、必ずしも原因が依存関係の不足とは限らない点は指摘しておく。
いまのところpip-compileには、パッケージのインストール処理が記述されたsetup.pyの実行時に例外が起きたとき、その例外の内容が隠されてしまう問題があり、他に原因がある可能性もある。
他に原因がありそうなときには、venvで仮想環境を作るなどして、一度通常のpip installを実行してみて、エラーログを確認して対処するとよいと思う。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/jazzband/pip-tools/issues/1583&quot;&gt;https://github.com/jazzband/pip-tools/issues/1583&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ともあれ、このようなpipに管理されていない依存関係は、
ドキュメントが整備されている通常のPythonパッケージであれば、
PyPIやパッケージの公式ドキュメントに利用者向けの記載があるはずなので、
そちらを確認してインストールしてからpip-compileを実行すると解消するだろう。&lt;/p&gt;&lt;p&gt;例えば、PostgreSQLドライバのpsycopg2は、以下のようなパッケージの事前インストールが必要である。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Cコンパイラ&lt;/li&gt;&lt;li&gt;Pythonのヘッダ&lt;/li&gt;&lt;li&gt;Postgresライブラリlibpqのヘッダ&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt install python3-dev libpq-dev build-essential
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.org/project/psycopg2/&quot;&gt;https://pypi.org/project/psycopg2/&lt;/a&gt; （現在 psycopg2==2.9.3）&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.psycopg.org/docs/install.html#build-prerequisites&quot;&gt;https://www.psycopg.org/docs/install.html#build-prerequisites&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;MySQLドライバのmysqlclientは、以下のようなパッケージの事前インストールが必要である。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt install python3-dev default-libmysqlclient-dev build-essential
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.org/project/mysqlclient/&quot;&gt;https://pypi.org/project/mysqlclient/&lt;/a&gt; （現在 mysqlclient==2.1.1）&lt;/li&gt;&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[自宅サーバのWebサービスをVPSで中継するようにした]]></title><description><![CDATA[自宅サーバのWebサービスをVPSで中継するようにした これまで自宅サーバへの外部からの接続には、
数年前から自宅のグローバルIPアドレスにフリーのドメインを紐づけて使っていたのですが、…]]></description><link>https://blog.aoirint.com/entry/2022/proxy_webservice_on_home_server_with_vps/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/proxy_webservice_on_home_server_with_vps/</guid><pubDate>Thu, 07 Apr 2022 11:00:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;自宅サーバのwebサービスをvpsで中継するようにした&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%85%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AEweb%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92vps%E3%81%A7%E4%B8%AD%E7%B6%99%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%9F&quot; aria-label=&quot;自宅サーバのwebサービスをvpsで中継するようにした permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自宅サーバのWebサービスをVPSで中継するようにした&lt;/h1&gt;&lt;p&gt;これまで自宅サーバへの外部からの接続には、
数年前から自宅のグローバルIPアドレスにフリーのドメインを紐づけて使っていたのですが、
3月末に更新を忘れてこのドメインを失効させてしまいました。&lt;/p&gt;&lt;p&gt;自宅サーバでは、主に個人用のWebサービスや身内用のゲームサーバが動いています。&lt;/p&gt;&lt;p&gt;同じドメインを再取得するには追加の料金がかかりますし、（若干用途が規約的に怪しいこともあり）新しくドメインを取り直す気にもなれなかったので、
以前から契約していたVPSをTCP/UDPプロキシとして使ってみることにしました。&lt;/p&gt;&lt;p&gt;この記事では、nginx.confのhttpディレクティブとstreamディレクティブそれぞれについて、拡張子でincludeを切り分けるようにする構成にしています。
基本的には、nginx.confに以下のように記述するイメージです。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;http {
        include /etc/nginx/conf.d/*.http;
}

stream {
        include /etc/nginx/conf.d/*.stream;
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;関連ツイート&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://twitter.com/aoirint/status/1510309731642257408&quot;&gt;https://twitter.com/aoirint/status/1510309731642257408&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://twitter.com/aoirint/status/1511896279731040261&quot;&gt;https://twitter.com/aoirint/status/1511896279731040261&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;また、この記事の内容には関係ありませんが、envsubstでconfigファイルに環境変数を注入する、nginxのDocker Hub公式Dockerイメージのtemplate機能を使用しているため、
nginx設定ファイルの拡張子がtemplateになっています。&lt;/p&gt;&lt;p&gt;上のツイートに関連して、&lt;code&gt;certbot --nginx&lt;/code&gt;で自動生成される&lt;code&gt;/etc/letsencrypt/options-ssl-nginx.conf&lt;/code&gt;を手動で&lt;code&gt;nginx.conf&lt;/code&gt;に統合しているので、
以下の設定ではコメントアウトされているincludeがあります。&lt;/p&gt;&lt;h2 id=&quot;構成&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E6%A7%8B%E6%88%90&quot; aria-label=&quot;構成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;構成&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;自宅サーバ側：systemd + autosshによる自動SSH接続＆リモートポート転送&lt;/li&gt;&lt;li&gt;VPS側：nginxによるHTTPリバースプロキシ・UDPプロキシ&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;自宅サーバ側&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%85%E3%82%B5%E3%83%BC%E3%83%90%E5%81%B4&quot; aria-label=&quot;自宅サーバ側 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自宅サーバ側&lt;/h2&gt;&lt;h3 id=&quot;sshconfig&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#sshconfig&quot; aria-label=&quot;sshconfig permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;~/.ssh/config&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-ssh&quot;&gt;Host vps*
    HostName VPS_IPADDR
    Port VPS_SSH_PORT
    ServerAliveInterval 10
    ServerAliveCountMax 5
    TCPKeepAlive yes
    IdentitiesOnly yes
    IdentityFile ~/.ssh/vps

Host vps-forwarding-homeserver
    # SERVICE1
    RemoteForward 127.0.0.1:VPS_SERVICE1_PORT 127.0.0.1:LOCAL_SERVICE1_PORT

    # SERVICE2
    RemoteForward 127.0.0.1:VPS_SERVICE2_PORT 127.0.0.1:LOCAL_SERVICE2_PORT
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;etcsystemdsystemautossh-vpsservice&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#etcsystemdsystemautossh-vpsservice&quot; aria-label=&quot;etcsystemdsystemautossh vpsservice permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;/etc/systemd/system/autossh-vps.service&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-systemd&quot;&gt;[Unit]
Description=AutoSSH VPS

[Service]
Type=simple
Restart=always
User=user
Group=user
WorkingDirectory=/home/user
ExecStart=/usr/bin/autossh -N vps-forwarding-homeserver

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;vps側&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#vps%E5%81%B4&quot; aria-label=&quot;vps側 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;VPS側&lt;/h2&gt;&lt;h3 id=&quot;httpリバースプロキシsshポート転送使用-myservicehttptemplate&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#http%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7ssh%E3%83%9D%E3%83%BC%E3%83%88%E8%BB%A2%E9%80%81%E4%BD%BF%E7%94%A8-myservicehttptemplate&quot; aria-label=&quot;httpリバースプロキシsshポート転送使用 myservicehttptemplate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTTPリバースプロキシ（SSHポート転送使用）: myservice.http.template&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
    server_name myservice.example.com;

    client_max_body_size 500M;

    add_header Strict-Transport-Security &amp;#x27;max-age=15552000; includeSubDomains; preload&amp;#x27;;

    location / {
        #auth_basic &amp;quot;Auth required&amp;quot;;
        #auth_basic_user_file /secrets/myservice.htpasswd;

        proxy_pass http://127.0.0.1:VPS_MYSERVICE_PORT;
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        send_timeout 3600s;
        proxy_connect_timeout 3600s;
        proxy_send_timeout 3600s;
        proxy_read_timeout 3600s;
        #proxy_max_temp_file_size 2048m;
    }

    location /.well-known/acme-challenge/ {
        root /letsencrypt-webroot;
    }

    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/myservice.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/myservice.example.com/privkey.pem;
    # include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

server {
    if ($host = myservice.example.com) {
        return 301 https://$host$request_uri;
    }

    server_name myservice.example.com;
    listen 80;
    return 404;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;udpポート転送sshポート転送不使用-myserviceudpstreamtemplate&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#udp%E3%83%9D%E3%83%BC%E3%83%88%E8%BB%A2%E9%80%81ssh%E3%83%9D%E3%83%BC%E3%83%88%E8%BB%A2%E9%80%81%E4%B8%8D%E4%BD%BF%E7%94%A8-myserviceudpstreamtemplate&quot; aria-label=&quot;udpポート転送sshポート転送不使用 myserviceudpstreamtemplate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;UDPポート転送（SSHポート転送不使用）: myserviceudp.stream.template&lt;/h3&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
        listen VPS_SERVICEUDP_PORT udp reuseport;

        proxy_pass HOME_IPADDR:HOME_SERVICEUDP_PORT;
        proxy_connect_timeout 3600s;
        proxy_timeout 3600s;
        #proxy_max_temp_file_size 2048m;
}
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[はてなブログから古い記事を移した]]></title><description><![CDATA[はてなブログから古い記事を移した 新しい記事 blog.aoirint.com へ投稿しつつ、
古い記事は aoirint.hatenablog.com に残っていましたが、
古い記事を blog.aoirint.com…]]></description><link>https://blog.aoirint.com/entry/2022/moved_from_hatenablog/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/moved_from_hatenablog/</guid><pubDate>Tue, 22 Feb 2022 20:40:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;はてなブログから古い記事を移した&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%AD%E3%82%B0%E3%81%8B%E3%82%89%E5%8F%A4%E3%81%84%E8%A8%98%E4%BA%8B%E3%82%92%E7%A7%BB%E3%81%97%E3%81%9F&quot; aria-label=&quot;はてなブログから古い記事を移した permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;はてなブログから古い記事を移した&lt;/h1&gt;&lt;p&gt;新しい記事 blog.aoirint.com へ投稿しつつ、
古い記事は aoirint.hatenablog.com に残っていましたが、
古い記事を blog.aoirint.com に移しました。&lt;/p&gt;&lt;p&gt;古い記事にはリダイレクトと移動先へのリンクを設置しています。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/x-motemen/blogsync&quot;&gt;https://github.com/x-motemen/blogsync&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;blogsyncで記事を取得したあと、以下のようなスクリプトでfrontmatterを変換しました。&lt;/p&gt;&lt;p&gt;以前の移行時の作業ミスでMarkdown記事がHTMLになってしまっていたので、
手動でMarkdownに書き戻しました。&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;import glob
import yaml
from datetime import datetime
from pathlib import Path
import frontmatter as FM

for path in glob.glob(&amp;#x27;**/*.md&amp;#x27;, recursive=True):
  if path.startswith(&amp;#x27;output&amp;#x27;):
    continue

  print(path)
  with open(path, &amp;#x27;r&amp;#x27;) as fp:
    frontmatter = FM.load(fp)
    # docs = yaml.safe_load_all(fp)
    # frontmatter = next(docs)
    # body = next(docs)

  body = frontmatter.content
  print(frontmatter)
  print(body)

  title = frontmatter[&amp;#x27;Title&amp;#x27;]
  if title.startswith(&amp;#x27;（移動済）&amp;#x27;):
    print(f&amp;#x27;Skipped: {title}&amp;#x27;)
    continue

  print(f&amp;#x27;Processing: {title}&amp;#x27;)

  original_url = frontmatter[&amp;#x27;URL&amp;#x27;]
  date: datetime = frontmatter[&amp;#x27;Date&amp;#x27;]
  draft = frontmatter.get(&amp;#x27;Draft&amp;#x27;, False)

  tags = frontmatter.get(&amp;#x27;Category&amp;#x27;)
  category = tags[0] if tags else None

  new_frontmatter = {
    &amp;#x27;title&amp;#x27;: title,
    &amp;#x27;date&amp;#x27;: date.strftime(&amp;#x27;%Y-%m-%d %H:%M:%S&amp;#x27;),
    &amp;#x27;draft&amp;#x27;: draft,
    &amp;#x27;channel&amp;#x27;: &amp;#x27;技術ノート&amp;#x27;,
  }
  if category:
    new_frontmatter[&amp;#x27;category&amp;#x27;] = category
  if tags:
    new_frontmatter[&amp;#x27;tags&amp;#x27;] = tags

  output = yaml.dump(new_frontmatter, default_flow_style=False, sort_keys=False, allow_unicode=True)
  output_lines = output.split(&amp;#x27;\n&amp;#x27;)
  output_lines.insert(0, f&amp;#x27;---&amp;#x27;)
  output_lines.insert(1, f&amp;#x27;# moved from {original_url}&amp;#x27;)
  output_lines.insert(-1, f&amp;#x27;---&amp;#x27;)
  output = &amp;#x27;\n&amp;#x27;.join(output_lines)
  output += f&amp;#x27;# {title}\n\n&amp;#x27; + body + &amp;#x27;\n&amp;#x27;

  dest = Path(&amp;#x27;output&amp;#x27;, path)
  dest.parent.mkdir(parents=True, exist_ok=True)

  with open(dest, &amp;#x27;w&amp;#x27;) as fp:
    fp.write(output)
&lt;/code&gt;&lt;/pre&gt;</content:encoded></item><item><title><![CDATA[えやみぐさの改修ログ 2022-02-20]]></title><description><![CDATA[えやみぐさの改修ログ 2022-02-20 えやみぐさ: blog.aoirint.com えやみぐさのGatsby設定ファイルのTypeScript化 レイアウト用の型定義を gatsby-node や gatsby-config で利用するために、これらのGatsby…]]></description><link>https://blog.aoirint.com/entry/2022/eyamigusa_gatsby_typescript/</link><guid isPermaLink="false">https://blog.aoirint.com/entry/2022/eyamigusa_gatsby_typescript/</guid><pubDate>Sun, 20 Feb 2022 08:10:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;えやみぐさの改修ログ-2022-02-20&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AE%E6%94%B9%E4%BF%AE%E3%83%AD%E3%82%B0-2022-02-20&quot; aria-label=&quot;えやみぐさの改修ログ 2022 02 20 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさの改修ログ 2022-02-20&lt;/h1&gt;&lt;p&gt;えやみぐさ: blog.aoirint.com&lt;/p&gt;&lt;h2 id=&quot;えやみぐさのgatsby設定ファイルのtypescript化&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AEgatsby%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AEtypescript%E5%8C%96&quot; aria-label=&quot;えやみぐさのgatsby設定ファイルのtypescript化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさのGatsby設定ファイルのTypeScript化&lt;/h2&gt;&lt;p&gt;レイアウト用の型定義を&lt;code&gt;gatsby-node&lt;/code&gt;や&lt;code&gt;gatsby-config&lt;/code&gt;で利用するために、これらのGatsby設定ファイルをTypeScript化することになりました。
以下の記事が参考になりました。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://miyauchi.dev/ja/posts/gatsby-typescript/&quot;&gt;https://miyauchi.dev/ja/posts/gatsby-typescript/&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;えやみぐさにチャンネル機能を追加&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AB%E3%83%81%E3%83%A3%E3%83%B3%E3%83%8D%E3%83%AB%E6%A9%9F%E8%83%BD%E3%82%92%E8%BF%BD%E5%8A%A0&quot; aria-label=&quot;えやみぐさにチャンネル機能を追加 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさに「チャンネル」機能を追加&lt;/h2&gt;&lt;p&gt;トピックの異なる記事を分離するために、「チャンネル」という単位で記事を分類するようにしました。&lt;/p&gt;&lt;p&gt;これまで、えやみぐさの記事は、カテゴリとタグによって分類していました。
しかし、この2つだけでは、例えば日記と技術記事の記事一覧を分離することができません（RSSや最近の記事一覧で問題になる）。
えやみぐさに異なるトピック・ジャンルの記事を統合するために、既存のカテゴリとタグによる分類を維持し、新しい階層を加えることにしました。
これまでのカテゴリ・タグは、チャンネル別に機能するようにしました。&lt;/p&gt;&lt;p&gt;いまのところ、この記事は作業ログというチャンネルに属しています。
通常の技術ノートに比べて、気軽にページを作ることができるようにと考えています。
あとで内容の一部を技術ノートに移す・写すこともあるかもしれません。
現在の技術ノートはあまり品質がよくない（メモ書きレベル）ので、作業ログに移してもいいかなと思っているのですが、そこそこ記事数があり、
中身を確認しながら再分類するのが手間なのでやっていません。
作業ログは、作業を中断したり、力尽きたりしたりして、中途半端な内容や矛盾した文章が載っていることがあるかもしれませんが、自分用のメモなので気にしないでいきたいと思っています。&lt;/p&gt;&lt;h2 id=&quot;えやみぐさの記事管理方法とurlフォーマットについて&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AE%E8%A8%98%E4%BA%8B%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E3%81%A8url%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;えやみぐさの記事管理方法とurlフォーマットについて permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさの記事管理方法とURLフォーマットについて&lt;/h2&gt;&lt;p&gt;えやみぐさでは、記事のURLを&lt;code&gt;entry/&amp;lt;作成年&amp;gt;/&amp;lt;slug&amp;gt;&lt;/code&gt;というフォーマットにしています。
このフォーマットは、えやみぐさの記事をファイルシステム上で管理しやすくするために選んだものです。&lt;/p&gt;&lt;p&gt;えやみぐさの記事を作成するときは、URLと対応したパスにディレクトリを作成し、&lt;code&gt;index.md&lt;/code&gt;ファイルを配置します。
これは、記事に付随するリソース（画像や音声ファイルなど）と記事本体をまとめて管理するためにそうしています。&lt;/p&gt;&lt;p&gt;比較として、&lt;code&gt;entry/&amp;lt;slug&amp;gt;&lt;/code&gt;方式では、ふつうに構成すると1ディレクトリにすべての記事ディレクトリを配置することになります。
例えば、2020年には下書きを含めて31件の記事があるのですが、
次の年も同じ数の記事を書いたとすると、計62件、その次の年なら計93件になることが予想されます。
昔書いた記事に補足を入れたいときや、新しい記事を書きたいときに、100件のサブディレクトリがあるディレクトリを操作するのは、
誤操作が起きやすい点、目に入る情報量が多く気が散る点から、望ましくない・苦手です。&lt;/p&gt;&lt;p&gt;&lt;code&gt;entry/&amp;lt;作成年&amp;gt;/&amp;lt;作成月&amp;gt;/&amp;lt;slug&amp;gt;&lt;/code&gt;や&lt;code&gt;entry/&amp;lt;作成年&amp;gt;/&amp;lt;作成月&amp;gt;/&amp;lt;作成日&amp;gt;/&amp;lt;slug&amp;gt;&lt;/code&gt;も考えられますが、
自分の記事作成ペースと、手作業で管理するのが手間に感じる点から採用しませんでした。&lt;/p&gt;&lt;h2 id=&quot;えやみぐさのurl永続性について&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AEurl%E6%B0%B8%E7%B6%9A%E6%80%A7%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;えやみぐさのurl永続性について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさのURL永続性について&lt;/h2&gt;&lt;p&gt;インターネット上のURLは、永続化することが望ましいという考え方があります。
例えば、ブックマークしておいたページが消えていると困りますし、リンクが貼られているとリンク切れを起こしてしまいます。&lt;/p&gt;&lt;p&gt;記事のURLの永続化には、URLの割り当て方法が関わってきます。
ブログシステムでのURLの割り当て方法としては、
記事タイトルの一部などによる「スラグ」を利用する方法、
DB上の連番IDを利用する方法、
時刻や日付を利用する方法、
ランダムなIDを利用する方法、
が思い付きます。
えやみぐさでは、記事のURLを&lt;code&gt;entry/&amp;lt;作成年&amp;gt;/&amp;lt;slug&amp;gt;&lt;/code&gt;というフォーマットにしています。&lt;/p&gt;&lt;p&gt;CMS・Wikiなどでは、URLを永続化するためにリダイレクトが自動で貼られる仕組みが用意されている場合がありますが、
えやみぐさのコンテンツ管理方式（GitリポジトリにMarkdownファイル）では、リダイレクトによってURLを永続化するのは難しく、
実装しても運用するのはそれなりの手間になります（例えば、リダイレクトだけの実体のない記事ページが記事ファイル一覧に含まれる、増え続けるリダイレクトリストの管理など）。&lt;/p&gt;&lt;p&gt;できるだけ記事URLを書き換えないようにしてはいますが、リンクが貼られにくい雑記については、
URL永続性を維持する動機がないので、適当に管理すると思います。&lt;/p&gt;&lt;p&gt;記事のURL名前空間は、チャンネル間で共通にしています（&lt;code&gt;entry/slug&lt;/code&gt;のこと）。
えやみぐさでは、チャンネル・カテゴリ・タグのようなタクソノミーは、あとで書き換えることがある、という運用を考えています。&lt;/p&gt;&lt;h2 id=&quot;えやみぐさの記事一覧について&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;えやみぐさの記事一覧について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさの記事一覧について&lt;/h2&gt;&lt;p&gt;これまで、えやみぐさのトップページでは、カテゴリの一覧と、各カテゴリの全記事リストを表示する方式をとっていました。
これは、過去に書いた技術記事を素早く参照するためのものでした。
この記事の執筆時点でも、技術記事用のチャンネル「技術ノート」では、同様の方式で記事一覧を表示するようにしています。&lt;/p&gt;&lt;h2 id=&quot;えやみぐさのデプロイ自動化について&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;えやみぐさのデプロイ自動化について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさのデプロイ自動化について&lt;/h2&gt;&lt;p&gt;えやみぐさを管理するGitリポジトリは、Gatsbyプロジェクトリポジトリと記事リポジトリの2つに分かれています（submoduleで管理しています）。
記事の可搬性とレイアウト・記事の分離のためにそうしていますが、固有記法を使うこともあるかもしれませんし、
まああまり細かいところは気にしないで運用しています。&lt;/p&gt;&lt;p&gt;えやみぐさのデプロイは、GatsbyプロジェクトリポジトリにpushされたときにはGitHub Actionsが走りますが、
記事リポジトリにpushされたときには走りません。&lt;/p&gt;&lt;p&gt;記事を更新したときには、親のGatsbyプロジェクトリポジトリのsubmoduleを更新する手間があります。&lt;/p&gt;&lt;p&gt;Webサイトのレイアウトを調整すること、記事を更新すること、をうまく共存させながら、この手間を解消したいのですが、
あんまりいい方法が思い付いていません。。。&lt;/p&gt;&lt;p&gt;例えば、記事を書くときにいちいちGatsbyでレンダリングするのは重くて手間なので、Gatsbyプロジェクトをcloneせずに
記事を追加するような運用をしたいと思っていますが、
レイアウトをいじるときには実際の記事があった方がいい、というような感じで、どうしたらいいのかなと思っています。&lt;/p&gt;&lt;p&gt;&lt;code&gt;workflow_dispatch&lt;/code&gt;をうまく組めば、片方のリポジトリが更新されたときにデプロイ走らせることはできると思うけれど、
ローカルで動かすときに微妙な気がしている...&lt;/p&gt;&lt;h2 id=&quot;えやみぐさのデプロイにおける2重コミット問題を解消した&quot; style=&quot;position:relative&quot;&gt;&lt;a href=&quot;#%E3%81%88%E3%82%84%E3%81%BF%E3%81%90%E3%81%95%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B2%E9%87%8D%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E5%95%8F%E9%A1%8C%E3%82%92%E8%A7%A3%E6%B6%88%E3%81%97%E3%81%9F&quot; aria-label=&quot;えやみぐさのデプロイにおける2重コミット問題を解消した permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;えやみぐさのデプロイにおける「2重コミット問題」を解消した&lt;/h2&gt;&lt;p&gt;「2重コミット問題」：テーマリポジトリと記事リポジトリを分離するため、submoduleを使って管理するとき、submoduleと親リポジトリの2つにそれぞれコミットするのが手間になる問題&lt;/p&gt;&lt;p&gt;API経由でWorkflowを実行する。スコープの広いPATが必要なのが難しいところなので、抵抗あったのだけれど、まあ便利なので仕方がない。&lt;/p&gt;&lt;p&gt;Gatsbyが2つのディレクトリを同じデータソースとして統合して扱うことができたので、submoduleを使わずにうまく分離することができた（VOICEVOX ENGINEのspeaker_infoをイメージした）。&lt;/p&gt;&lt;p&gt;このおかげで、ローカルでのプレビューもできる（Gatsbyが重いのでレイアウト変えるとき以外は、多少表示崩れても手間なのでGatsbyでレンダリングしない方がいいと思っているけれど）。&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9fcdac93255106c1f11cf220bff523ab/236d7/eyamigusa_new_workflow.png&quot; style=&quot;display:block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:30.061349693251532%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA6ElEQVQY03VQgW6FIAz0/z9yiXPz+VABFQRKy73A29ySvTVpmt7RK9eOeYM7JhBpvI6C/6KUv1xHNEHd3xDCgBgIeg3Q69nqZhPqjEiBNbFhRodWvaNL9Hd2RDOMGRDOEaUIiATeBxAxOMu1OWdp2JMTCL/+eVdKBpAgQkiRkUlg7YGUGJQEzKWJ1T7FjM0eTbD2VbS+SUkQIze8+z4D56etdfHoe4XbaLAsHt4lOJcap9SO917B6LNZDyfBmoDxU7c573IVLF/H/bHATGDOV+77iVl5qPuBj2HFrBym24YYqzOGFL4sPwBM49S+bsM7rgAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;eyamigusa new workflow&quot; title=&quot;eyamigusa new workflow&quot; src=&quot;/static/9fcdac93255106c1f11cf220bff523ab/a6d36/eyamigusa_new_workflow.png&quot; srcSet=&quot;/static/9fcdac93255106c1f11cf220bff523ab/222b7/eyamigusa_new_workflow.png 163w,/static/9fcdac93255106c1f11cf220bff523ab/ff46a/eyamigusa_new_workflow.png 325w,/static/9fcdac93255106c1f11cf220bff523ab/a6d36/eyamigusa_new_workflow.png 650w,/static/9fcdac93255106c1f11cf220bff523ab/e548f/eyamigusa_new_workflow.png 975w,/static/9fcdac93255106c1f11cf220bff523ab/3c492/eyamigusa_new_workflow.png 1300w,/static/9fcdac93255106c1f11cf220bff523ab/236d7/eyamigusa_new_workflow.png 1486w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item></channel></rss>